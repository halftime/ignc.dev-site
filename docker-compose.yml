version: '3.8'

services:
  ignc-dev-site:
    build:
      context: .
      dockerfile: ignc.dev/Dockerfile
      platforms:
        - linux/arm64
    image: ignc-dev-site:latest
    container_name: ignc-dev-site
    ports:
      - "80:4040"    # HTTP port
      - "443:4041"   # HTTPS port
    volumes:
      - ./certs:/home/admin/certs:ro  # Mount certificate directory as read-only
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:4040;https://+:4041
      - ASPNETCORE_Kestrel__Certificates__Default__Path=./certs/cloudflare-origin.pem
      - ASPNETCORE_Kestrel__Certificates__Default__KeyPath=./certs/cloudflare-origin.key
    restart: unless-stopped
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:8081/health", "||", "exit", "1"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 40s